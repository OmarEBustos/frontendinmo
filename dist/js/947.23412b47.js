"use strict";(self["webpackChunktienda"]=self["webpackChunktienda"]||[]).push([[947],{4947:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var i=function(){var t=this,e=t._self._c;return e("div",["pending"==t.estado||"failure"==t.estado?e("section",{staticClass:"hero",staticStyle:{"margin-top":"8rem !important"}},[e("div",{staticClass:"container"},[e("ol",{staticClass:"breadcrumb justify-content-center"},[e("li",{staticClass:"breadcrumb-item"},[e("router-link",{attrs:{to:"/"}},[t._v("Inicio")])],1)]),t._m(0)])]):t._e(),"success"==t.estado?e("section",{staticClass:"hero",staticStyle:{"margin-top":"8rem !important"}},[t.msm_error?t._e():e("div",{staticClass:"container"},[e("ol",{staticClass:"breadcrumb justify-content-center"},[e("li",{staticClass:"breadcrumb-item"},[e("router-link",{attrs:{to:"/"}},[t._v("Inicio")])],1)]),t._m(1)]),t.msm_error?e("div",{staticClass:"container"},[e("ol",{staticClass:"breadcrumb justify-content-center"},[e("li",{staticClass:"breadcrumb-item"},[e("router-link",{attrs:{to:"/"}},[t._v("Inicio")])],1)]),e("div",{staticClass:"hero-content pb-5 text-center"},[e("h1",{staticClass:"mb-5"},[t._v(t._s(t.msm_error))]),t._m(2)])]):t._e()]):t._e()])},s=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"hero-content pb-5 text-center"},[e("h1",{staticClass:"mb-5"},[t._v("Pago incorrecto")]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-xl-8 offset-xl-2"},[e("p",{staticClass:"lead mb-0"},[t._v("As am hastily invited settled at limited civilly fortune me. Really spring in extent an by. Judge but built party world. Of so am he remember although required. Bachelor unpacked be advanced at. Confined in declared marianne is vicinity. ")])])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"hero-content pb-5 text-center"},[e("h1",{staticClass:"mb-5"},[t._v("Validando pago...")]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-xl-8 offset-xl-2"},[e("img",{staticStyle:{width:"80px"},attrs:{src:"/assets/media/reloj.gif"}})])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("div",{staticClass:"col-xl-8 offset-xl-2"},[e("p",{staticClass:"lead mb-0"},[t._v("As am hastily invited settled at limited civilly fortune me. Really spring in extent an by. Judge but built party world. Of so am he remember although required. Bachelor unpacked be advanced at. Confined in declared marianne is vicinity. ")])])])}],r=a(5121),n={name:"VerificacionView",data(){return{estado:"",payment_id:"",pago:{},direccion:"",msm_error:"",venta:{},detalles:[],total:0,carrito:[]}},beforeMount(){this.estado=this.$route.params.estado,this.payment_id=this.$route.query.payment_id,this.init_carrito();let t=JSON.parse(this.$store.state.user);this.venta.transaccion=this.payment_id,this.venta.envio=this.$envio,this.venta.cliente=t._id,this.$route.params.direccion?(this.direccion=this.$route.params.direccion,this.venta.direccion=this.direccion):this.msm_error="No se obtuvo el código de la dirección",this.init_payment(this.payment_id),console.log(this.venta),console.log(this.detalles)},methods:{init_carrito(){r.Z.get(this.$url+"/obtener_carrito_cliente",{headers:{"Content-Type":"application/json",Authorization:this.$store.state.token}}).then((t=>{for(var e of(this.total=0,t.data.carrito_general)){let t=e.producto.precio*e.cantidad;this.total=this.total+t,this.detalles.push({subtotal:t,precio_unidad:e.producto.precio,cantidad:e.cantidad,cliente:this.venta.cliente,producto:e.producto._id,variedad:e.variedad._id})}this.venta.total=this.total,this.carrito=t.data.carrito_general}))},validar_venta(t){r.Z.get(this.$url+"/validar_payment_id_venta/"+t,{headers:{"Content-Type":"application/json",Authorization:this.$store.state.token}}).then((t=>{t.data.length>=1?this.msm_error="El pago ya fué asignado a otra venta":0==t.data.length&&this.crear_venta()}))},crear_venta(){this.venta.detalles=this.detalles,r.Z.post(this.$url+"/crear_venta_cliente",this.venta,{headers:{"Content-Type":"application/json",Authorization:this.$store.state.token}}).then((t=>{console.log(t),this.$router.push({name:"venta",params:{id:t.data._id}}),this.$socket.emit("send_cart",!0)}))},init_payment(t){r.Z.get("https://api.mercadopago.com/v1/payments/"+t,{headers:{"Content-Type":"application/json",Authorization:"Bearer TEST-3299853704240812-011910-c92d25f431290a1d9cc068c476d83452-149313662"}}).then((t=>{this.pago=t.data,"approved"==this.pago.status?this.validar_venta(this.payment_id):this.msm_error="El pago fué aprovado"}))}}},o=n,c=a(1001),l=(0,c.Z)(o,i,s,!1,null,null,null),d=l.exports}}]);
//# sourceMappingURL=947.23412b47.js.map